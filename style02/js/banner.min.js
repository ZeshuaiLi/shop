$(function () {
    window.mySwiper = {};
    mySwiper.transitionEnd = function (dom, callback) {
        if (!dom || typeof dom != "object") {
            return false
        }
        dom.addEventListener("transitionEnd", function () {
            callback && callback()
        });
        dom.addEventListener("webkitTransitionEnd", function () {
            callback && callback()
        })
    };
    $($("#progations").children()[0]).addClass("now");
    mySwiper.tap = function (dom, callback) {
        if (!dom || typeof dom != "object") {
            return false
        }
        var isMove = false;
        var time = 0;
        dom.addEventListener("touchstart", function () {
            time = Date.now()
        });
        dom.addEventListener("touchmove", function () {
            isMove = true
        });
        window.addEventListener("touchend", function (e) {
            if (!isMove && Date.now() - time < 150) {
                callback && callback(e)
            }
            isMove = false;
            time = 0
        })
    };
    var imageCount = $(".banerList li").length - 2;
    $(".banerList").css({
        width: 200 + 100 * imageCount + "%",
        transform: "translateX(" + -100 / (imageCount + 2) + "%)"
    });
    $(".banner_slider ul:first-child li").css("width", 100 / (imageCount + 2) + "%");
    var banner = document.querySelector(".banner_slider");
    var width = banner.offsetWidth;
    var imageBox = banner.querySelector("ul:first-child");
    var pointBox = banner.querySelector("ul:last-child");
    var points = pointBox.querySelectorAll("li");
    var addTransition = function () {
        imageBox.style.transition = "all 0.3s";
        imageBox.style.webkitTransition = "all 0.3s"
    };
    var removeTransition = function () {
        imageBox.style.transition = "none";
        imageBox.style.webkitTransition = "none"
    };
    var setTranslateX = function (translateX) {
        imageBox.style.transform = "translateX(" + translateX + "px)";
        imageBox.style.webkitTransform = "translateX(" + translateX + "px)"
    };
    var index = 1;
    mySwiper.transitionEnd(imageBox, function () {
        if (index > imageCount) {
            index = 1
        } else if (index <= 0) {
            index = imageCount
        }
        removeTransition();
        setTranslateX(-index * width);
        setPoint()
    });
    var setPoint = function () {
        for (var i = 0; i < points.length; i++) {
            points[i].className = ""
        }
        if (points.length) {
            points[index - 1].className = "now"
        }
        var height = $(".banner_slider ul:first-child li").eq(index).height();
        $(".banner_slider").height(height)
    };
    setPoint();
    var startX = 0;
    var moveX = 0;
    var distanceX = 0;
    var isMove = false;
    imageBox.addEventListener("touchstart", function (e) {
        startX = e.touches[0].clientX
    });
    imageBox.addEventListener("touchmove", function (e) {
        moveX = e.touches[0].clientX;
        distanceX = moveX - startX;
        removeTransition();
        setTranslateX(-index * width + distanceX);
        isMove = true
    });
    imageBox.addEventListener("touchend", function (e) {
        if (isMove && Math.abs(distanceX) > width / 3) {
            if (distanceX > 0) {
                index--
            } else {
                index++
            }
        }
        addTransition();
        setTranslateX(-index * width);
        if (index > imageCount) {
            index = 1
        } else if (index <= 0) {
            index = imageCount
        }
        setPoint()
    });
    $(".prev").click(function () {
        index--;
        addTransition();
        setTranslateX(-index * width);
        if (index > imageCount) {
            index = 1
        } else if (index <= 0) {
            index = imageCount
        }
        setPoint()
    });
    $(".next").click(function () {
        index++;
        addTransition();
        setTranslateX(-index * width);
        if (index > imageCount) {
            index = 1
        } else if (index <= 0) {
            index = imageCount
        }
        setPoint()
    })
});